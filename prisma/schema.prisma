generator client {
  provider         = "prisma-client-js"
  output           = "./generated"
  connection_limit = 10
}

datasource db {
  provider = "postgresql"
  url      = env("CLIENT_DATABASE_URI")
}

model Category {
  id            String     @id
  parentId      String?
  level         Int
  name          String
  sourceName    String
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  parent        Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  subCategories Category[] @relation("CategoryHierarchy")
  products      Product[]

  @@index([parentId])
  @@map("categories")
}

model Product {
  id          String           @id
  categoryId  String?
  groupId     String? // ID группы (если нужно)
  groupName   String? // Название группы (если не нормализовано)
  name        String
  brand       String?
  article     String?
  description String?
  price       Float? // Может быть null, если цена определяется только в вариантах
  sourceName  String
  pictures    Json             @default("[]") // JSON-массив строк или объектов
  params      Json? // { "label": "value", ... } или массив [{label, value}]
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  category    Category?        @relation(fields: [categoryId], references: [id])
  variants    ProductVariant[]

  @@index([categoryId])
  @@index([groupId])
  @@map("products")
}

model ProductVariant {
  id       String  @id
  parentId String // Ссылка на Product.id
  price    Float?
  name     String
  params   Json? // Доп. параметры варианта
  product  Product @relation(fields: [parentId], references: [id])

  @@map("product_variants")
}
